---
layout:     post
title:      "Spring循环依赖"
subtitle:   " \"循环依赖的一些理解\""
date:       2023-09-05 19:00:00
author:     "王元存"
header-style: text
catalog: true
tags:
- spring
---

在Spring中是怎么处理循环依赖的？
------
假设我们现在有两个需要创建的Bean,分别为BeanA和BeanB,在BeanA创建时依赖BeanB,在BeanB创建时依赖BeanA,如下面代码：

```
@Component
public class BeanB {
	@Autowired
	private BeanA a;
}
```
````
@Component
public class BeanA {
	@Autowired
	private BeanB b;
}
````

上面的代码构成了最基本的循环依赖,那么Spring是如何解决这个问题的呢,涉及到了***Spring的三级缓存***:
- singletonObject:进行了完整的生命周期; 一级缓存
- earlySingletonObject: 提前暴露的bean,但是没有进行完整的生命周期,在实例化之后,初始化之前; 二级缓存
- singletonFactory：里面存了一个lambda表达式,把执行的结果存到二级缓存中,这个执行结果可能是原始对象也可能是aop之后的代理对象;  三级缓存

为什么需要三级缓存?
------
拿上面的BeanA和BeanB我们来具体说一下：

BeanA实例化之后 -> 把lambda表达式getEarlyBeanReference(beanName,mbd,bean)存入三级缓存中 ->







